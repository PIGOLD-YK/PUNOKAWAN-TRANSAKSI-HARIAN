<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Transaksi Punokawan Group</title>
    <style>
        body {
            background-color: gold;
            color: black;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        h1, h2, h3 {
            margin: 10px 0;
        }
        #total {
            font-size: 2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Data Transaksi Punokawan Group</h1>
    <h2 id="date">Tanggal: -- | Waktu: --</h2>
    <h3>Akumulasi Hari Ini</h3>
    <h1 id="total">Loading...</h1>
    <p><strong>Powered By PIGOLD th 2025</strong></p>
    
    <script>
        const sheetId = "1WRaA_8OTcR42t01CLehqw20ZN0nWB64xSgSEdl54vIY";
        const sheetName = "DataTransaksi";
        const apiKey = "AIzaSyCZCnqUu799bOvs4TdGpqA4wnq0KXIvq4A";
        const range = "G:G"; // Kolom transaksi

        async function fetchTransactionData() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${range}?key=${apiKey}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data.values) {
                    updateTotal(data.values);
                } else {
                    document.getElementById("total").innerText = "Data tidak ditemukan";
                }
            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById("total").innerText = "Gagal mengambil data";
            }
        }

        function updateTotal(values) {
            let total = 0;
            const now = new Date();
            const today = now.toISOString().split('T')[0]; // Format YYYY-MM-DD
            const time = now.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit", second: "2-digit" });
            
            values.forEach(row => {
                let amount = parseFloat(row[0]);
                if (!isNaN(amount)) {
                    total += amount;
                }
            });
            document.getElementById("date").innerText = `Tanggal: ${today} | Waktu: ${time}`;
            document.getElementById("total").innerText = formatRupiah(total);
        }

        function formatRupiah(angka) {
            return new Intl.NumberFormat("id-ID", { style: "currency", currency: "IDR" }).format(angka);
        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchTransactionData();
            setInterval(fetchTransactionData, 60000); // Update setiap 60 detik
        });
    </script>
</body>
</html>
